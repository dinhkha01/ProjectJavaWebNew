<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n L√Ω ·ª®ng Vi√™n</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/sidebar.css">
    <link rel="stylesheet" href="/static/css/admin/candidateList.css">

</head>
<body>
<!-- Include Sidebar -->
<th:block th:replace="~{fragments/sidebar :: sidebar}"></th:block>

<div class="main-content">
    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="welcome-text mb-2">üöÄ Qu·∫£n L√Ω ·ª®ng Vi√™n</h1>
                <p class="subtitle mb-0">Kh√°m ph√° v√† qu·∫£n l√Ω t√†i nƒÉng c√¥ng ngh·ªá t∆∞∆°ng lai</p>
            </div>
        </div>
    </div>

    <!-- Search and Filter Section -->
    <div class="search-filter-section glass-card">
        <form th:action="@{/admin/candidates}" method="get">
            <!-- Search Box -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <label for="keyword" class="form-label">üîç T√¨m ki·∫øm theo t√™n:</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="keyword" name="keyword"
                               th:value="${pageDto.keyword}" placeholder="Nh·∫≠p t√™n ·ª©ng vi√™n...">
                        <button class="btn btn-primary" type="submit">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="row">
                        <div class="col-6">
                            <label class="form-label">üìä S·∫Øp x·∫øp:</label>
                            <select class="form-select" name="sortBy" th:value="${pageDto.sortBy}">
                                <option value="id" th:selected="${pageDto.sortBy == 'id'}">üÜï M·ªõi nh·∫•t</option>
                                <option value="name" th:selected="${pageDto.sortBy == 'name'}">üî§ T√™n A-Z</option>
                                <option value="experience" th:selected="${pageDto.sortBy == 'experience'}">üíº Kinh nghi·ªám</option>
                                <option value="dob" th:selected="${pageDto.sortBy == 'dob'}">üéÇ Tu·ªïi</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filter Row -->
            <div class="filter-row">
                <!-- Experience Filter -->
                <div class="filter-group">
                    <label>üíº Kinh nghi·ªám (nƒÉm):</label>
                    <div class="row g-2">
                        <div class="col-6">
                            <input type="number" class="form-control" name="minExperience"
                                   th:value="${minExperience}" placeholder="T·ª´" min="0">
                        </div>
                        <div class="col-6">
                            <input type="number" class="form-control" name="maxExperience"
                                   th:value="${maxExperience}" placeholder="ƒê·∫øn" min="0">
                        </div>
                    </div>
                </div>

                <!-- Age Filter -->
                <div class="filter-group">
                    <label>üéÇ Tu·ªïi:</label>
                    <div class="row g-2">
                        <div class="col-6">
                            <input type="number" class="form-control" name="minAge"
                                   th:value="${minAge}" placeholder="T·ª´" min="18" max="65">
                        </div>
                        <div class="col-6">
                            <input type="number" class="form-control" name="maxAge"
                                   th:value="${maxAge}" placeholder="ƒê·∫øn" min="18" max="65">
                        </div>
                    </div>
                </div>

                <!-- Gender Filter -->
                <div class="filter-group">
                    <label>üë• Gi·ªõi t√≠nh:</label>
                    <select class="form-select" name="gender">
                        <option value="all" th:selected="${selectedGender == 'all'}">T·∫•t c·∫£</option>
                        <option value="Nam" th:selected="${selectedGender == 'Nam'}">üë® Nam</option>
                        <option value="N·ªØ" th:selected="${selectedGender == 'N·ªØ'}">üë© N·ªØ</option>
                    </select>
                </div>

                <!-- Technology Filter -->
                <div class="filter-group">
                    <label>üíª C√¥ng ngh·ªá:</label>
                    <select class="form-select" name="technology">
                        <option value="all" th:selected="${selectedTechnology == 'all'}">T·∫•t c·∫£</option>
                        <option value="Java" th:selected="${selectedTechnology == 'Java'}">‚òï Java</option>
                        <option value="Python" th:selected="${selectedTechnology == 'Python'}">üêç Python</option>
                        <option value="JavaScript" th:selected="${selectedTechnology == 'JavaScript'}">üü® JavaScript</option>
                        <option value="React" th:selected="${selectedTechnology == 'React'}">‚öõÔ∏è React</option>
                        <option value="Angular" th:selected="${selectedTechnology == 'Angular'}">üÖ∞Ô∏è Angular</option>
                        <option value="Node.js" th:selected="${selectedTechnology == 'Node.js'}">üü¢ Node.js</option>
                    </select>
                </div>

                <!-- Action Buttons -->
                <div class="filter-group">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-filter me-1"></i>L·ªçc
                    </button>
                    <a th:href="@{/admin/candidates}" class="btn btn-reset ms-2">
                        <i class="fas fa-undo me-1"></i>Reset
                    </a>
                </div>
            </div>
        </form>
    </div>

    <div class="content-card glass-card">
        <!-- Candidates Table -->
        <div class="table-responsive">
            <table class="table table-modern">
                <thead>
                <tr>
                    <th>üìã STT</th>
                    <th>üë§ ·ª®ng vi√™n</th>
                    <th>üìû Li√™n h·ªá</th>
                    <th>üíº Kinh nghi·ªám</th>
                    <th>üéÇ Tu·ªïi/Gi·ªõi t√≠nh</th>
                    <th>üíª C√¥ng ngh·ªá</th>
                    <th>üìä Tr·∫°ng th√°i</th>
                    <th class="text-end">‚öôÔ∏è Thao t√°c</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="candidate,stat : ${pageDto.content}">
                    <td th:text="${pageDto.currentPage * pageDto.size + stat.index + 1}" class="fw-bold text-primary"></td>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="candidate-avatar" th:text="${candidate.name.substring(0,1)}"></div>
                            <div>
                                <div class="fw-bold fs-6" th:text="${candidate.name}"></div>
                                <small class="text-muted" th:text="${candidate.email}"></small>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="mb-1">
                            <i class="fas fa-envelope me-2 text-primary"></i>
                            <span th:text="${candidate.email}"></span>
                        </div>
                        <div th:if="${candidate.phone}">
                            <i class="fas fa-phone me-2 text-success"></i>
                            <span th:text="${candidate.phone}"></span>
                        </div>
                    </td>
                    <td>
                        <span class="experience-badge" th:text="${candidate.experience} + ' nƒÉm'"></span>
                    </td>
                    <td>
                        <div class="mb-1">
                            <span class="age-badge" th:text="${candidate.age} + ' tu·ªïi'"></span>
                        </div>
                        <small class="text-muted fw-semibold" th:text="${candidate.gender}"></small>
                    </td>
                    <td>
                        <div class="tech-tags">
                            <span th:each="tech : ${candidate.technologyNames}"
                                  class="badge bg-info me-1" th:text="${tech}"></span>
                            <span th:if="${#lists.isEmpty(candidate.technologyNames)}"
                                  class="text-muted small">Ch∆∞a c√≥</span>
                        </div>
                    </td>
                    <td>
                        <span th:if="${candidate.isDeleted}" class="badge bg-danger status-indicator">
                            <i class="fas fa-ban me-1"></i>ƒê√£ x√≥a
                        </span>
                        <span th:if="${!candidate.isDeleted and candidate.status == 'active'}"
                              class="badge bg-success status-indicator active">
                            <i class="fas fa-check-circle me-1"></i>Ho·∫°t ƒë·ªông
                        </span>
                        <span th:if="${!candidate.isDeleted and candidate.status == 'inactive'}"
                              class="badge bg-warning status-indicator inactive">
                            <i class="fas fa-pause-circle me-1"></i>ƒê√£ kh√≥a
                        </span>
                    </td>
                    <td class="text-end action-buttons">
                        <form th:if="${!candidate.isDeleted}"
                              th:action="@{/admin/candidates/toggle-status/{id}(id=${candidate.id})}"
                              method="post" class="d-inline">
                            <button type="submit"
                                    th:class="${candidate.status == 'active'} ? 'btn btn-warning interactive' : 'btn btn-success interactive'"
                                    th:title="${candidate.status == 'active'} ? 'Kh√≥a t√†i kho·∫£n' : 'M·ªü kh√≥a t√†i kho·∫£n'"
                                    th:onclick="'return confirm(\'B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ' + (${candidate.status == 'active'} ? 'kh√≥a' : 'm·ªü kh√≥a') + ' t√†i kho·∫£n n√†y?\')'">
                                <i th:class="${candidate.status == 'active'} ? 'fas fa-lock' : 'fas fa-unlock'"></i>
                            </button>
                        </form>

                        <button th:if="${candidate.isDeleted}" class="btn btn-secondary disabled" title="ƒê√£ x√≥a">
                            <i class="fas fa-ban"></i>
                        </button>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(pageDto.content)}">
                    <td colspan="8">
                        <div class="empty-state">
                            <i class="fas fa-user-slash"></i>
                            <h4>Kh√¥ng t√¨m th·∫•y ·ª©ng vi√™n n√†o</h4>
                            <p class="text-muted">H√£y th·ª≠ ƒëi·ªÅu ch·ªânh b·ªô l·ªçc ho·∫∑c t√¨m ki·∫øm v·ªõi t·ª´ kh√≥a kh√°c</p>
                            <a th:href="@{/admin/candidates}" class="btn btn-primary interactive">
                                <i class="fas fa-undo me-2"></i>Xem t·∫•t c·∫£ ·ª©ng vi√™n
                            </a>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <nav th:if="${pageDto.totalPages > 1}" class="mt-4">
            <ul class="pagination justify-content-center">
                <li class="page-item" th:classappend="${pageDto.currentPage == 0} ? 'disabled' : ''">
                    <a class="page-link interactive" th:href="@{/admin/candidates(page=${pageDto.currentPage - 1},
                          size=${pageDto.size},
                          keyword=${pageDto.keyword},
                          sortBy=${pageDto.sortBy},
                          direction=${pageDto.direction},
                          minExperience=${minExperience},
                          maxExperience=${maxExperience},
                          minAge=${minAge},
                          maxAge=${maxAge},
                          gender=${selectedGender},
                          technology=${selectedTechnology})}">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>

                <li th:each="i : ${#numbers.sequence(1, pageDto.totalPages)}"
                    class="page-item" th:classappend="${i+-1 == pageDto.currentPage} ? 'active' : ''">
                    <a class="page-link interactive" th:href="@{/admin/candidates(page=${i+ -1},
                          size=${pageDto.size},
                          keyword=${pageDto.keyword},
                          sortBy=${pageDto.sortBy},
                          direction=${pageDto.direction},
                          minExperience=${minExperience},
                          maxExperience=${maxExperience},
                          minAge=${minAge},
                          maxAge=${maxAge},
                          gender=${selectedGender},
                          technology=${selectedTechnology})}"
                       th:text="${i}"></a>
                </li>

                <li class="page-item" th:classappend="${pageDto.currentPage == pageDto.totalPages - 1} ? 'disabled' : ''">
                    <a class="page-link interactive" th:href="@{/admin/candidates(page=${pageDto.currentPage + 1},
                          size=${pageDto.size},
                          keyword=${pageDto.keyword},
                          sortBy=${pageDto.sortBy},
                          direction=${pageDto.direction},
                          minExperience=${minExperience},
                          maxExperience=${maxExperience},
                          minAge=${minAge},
                          maxAge=${maxAge},
                          gender=${selectedGender},
                          technology=${selectedTechnology})}">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </li>
            </ul>
        </nav>
    </div>

    <!-- Stats Cards Section -->
    <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="glass-card stats-card text-center">
                <div class="stats-icon total mx-auto">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stats-number" data-count="156">0</div>
                <div class="stats-label">T·ªïng ·ª©ng vi√™n</div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="glass-card stats-card text-center">
                <div class="stats-icon active mx-auto">
                    <i class="fas fa-user-check"></i>
                </div>
                <div class="stats-number" data-count="132">0</div>
                <div class="stats-label">ƒêang ho·∫°t ƒë·ªông</div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="glass-card stats-card text-center">
                <div class="stats-icon inactive mx-auto">
                    <i class="fas fa-user-clock"></i>
                </div>
                <div class="stats-number" data-count="18">0</div>
                <div class="stats-label">T·∫°m kh√≥a</div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="glass-card stats-card text-center">
                <div class="stats-icon deleted mx-auto">
                    <i class="fas fa-user-times"></i>
                </div>
                <div class="stats-number" data-count="6">0</div>
                <div class="stats-label">ƒê√£ x√≥a</div>
            </div>
        </div>
    </div>
</div>

<!-- Flash Messages -->
<div class="position-fixed top-0 end-0 p-3" style="z-index: 1050">
    <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fas fa-check-circle me-2"></i>
        <span th:text="${successMessage}"></span>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-circle me-2"></i>
        <span th:text="${errorMessage}"></span>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
</div>

<!-- Floating Action Button -->
<div class="position-fixed bottom-0 end-0 p-4">
    <div class="dropdown dropup">
        <button class="btn btn-primary rounded-circle" type="button" data-bs-toggle="dropdown"
                style="width: 60px; height: 60px; box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);">
            <i class="fas fa-plus fa-lg"></i>
        </button>
        <ul class="dropdown-menu dropdown-menu-end glass-effect">
            <li><a class="dropdown-item" href="#"><i class="fas fa-user-plus me-2"></i>Th√™m ·ª©ng vi√™n</a></li>
            <li><a class="dropdown-item" href="#"><i class="fas fa-file-import me-2"></i>Import Excel</a></li>
            <li><a class="dropdown-item" href="#"><i class="fas fa-file-export me-2"></i>Export d·ªØ li·ªáu</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#"><i class="fas fa-chart-bar me-2"></i>B√°o c√°o</a></li>
        </ul>
    </div>
</div>

<!-- Loading Overlay -->
<div id="loadingOverlay" class="position-fixed top-0 start-0 w-100 h-100 d-none"
     style="background: rgba(102, 126, 234, 0.8); backdrop-filter: blur(10px); z-index: 9999;">
    <div class="d-flex justify-content-center align-items-center h-100">
        <div class="text-center text-white">
            <div class="loading-spinner mb-3"></div>
            <h4>ƒêang t·∫£i d·ªØ li·ªáu...</h4>
            <p>Vui l√≤ng ch·ªù trong gi√¢y l√°t</p>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Animate stats numbers
        const animateNumbers = () => {
            const counters = document.querySelectorAll('.stats-number');
            counters.forEach(counter => {
                const target = parseInt(counter.getAttribute('data-count'));
                if (isNaN(target)) return;

                let current = 0;
                const increment = target / 60;
                const timer = setInterval(() => {
                    current += increment;
                    if (current >= target) {
                        counter.textContent = target.toLocaleString();
                        clearInterval(timer);
                    } else {
                        counter.textContent = Math.floor(current).toLocaleString();
                    }
                }, 30);
            });
        };

        // Intersection Observer for stats animation
        const statsObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    animateNumbers();
                    statsObserver.unobserve(entry.target);
                }
            });
        });

        const statsSection = document.querySelector('.row.mb-4');
        if (statsSection) {
            statsObserver.observe(statsSection);
        }

        // Enhanced form interactions
        const form = document.querySelector('form');
        const loadingOverlay = document.getElementById('loadingOverlay');

        if (form) {
            form.addEventListener('submit', function(e) {
                loadingOverlay.classList.remove('d-none');

                // Hide loading after a delay (simulate processing)
                setTimeout(() => {
                    loadingOverlay.classList.add('d-none');
                }, 1000);
            });
        }

        // Auto-submit form when certain filters change
        const autoSubmitElements = document.querySelectorAll('select[name="sortBy"], select[name="gender"], select[name="technology"]');
        autoSubmitElements.forEach(element => {
            element.addEventListener('change', function() {
                loadingOverlay.classList.remove('d-none');
                setTimeout(() => {
                    this.form.submit();
                }, 300);
            });
        });

        // Enhanced table row interactions
        const tableRows = document.querySelectorAll('.table-modern tbody tr');
        tableRows.forEach(row => {
            row.addEventListener('mouseenter', function() {
                this.style.background = 'linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(102,126,234,0.05) 100%)';
            });

            row.addEventListener('mouseleave', function() {
                this.style.background = 'rgba(255, 255, 255, 0.95)';
            });
        });

        // Enhanced button interactions
        const buttons = document.querySelectorAll('.btn');
        buttons.forEach(button => {
            button.addEventListener('click', function(e) {
                // Add ripple effect
                const ripple = document.createElement('span');
                const rect = this.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                const x = e.clientX - rect.left - size / 2;
                const y = e.clientY - rect.top - size / 2;

                ripple.style.cssText = `
                    position: absolute;
                    border-radius: 50%;
                    background: rgba(255,255,255,0.6);
                    transform: scale(0);
                    animation: ripple 0.6s linear;
                    width: ${size}px;
                    height: ${size}px;
                    left: ${x}px;
                    top: ${y}px;
                    pointer-events: none;
                `;

                this.style.position = 'relative';
                this.style.overflow = 'hidden';
                this.appendChild(ripple);

                setTimeout(() => {
                    ripple.remove();
                }, 600);
            });
        });

        // Enhanced search functionality
        const searchInput = document.getElementById('keyword');
        if (searchInput) {
            let searchTimeout;
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    if (this.value.length >= 2 || this.value.length === 0) {
                        // Add visual feedback
                        this.style.borderColor = '#667eea';
                        this.style.boxShadow = '0 0 0 3px rgba(102, 126, 234, 0.1)';

                        setTimeout(() => {
                            this.style.borderColor = '';
                            this.style.boxShadow = '';
                        }, 1000);
                    }
                }, 500);
            });
        }

        // Enhanced status toggle confirmation
        window.confirmToggleStatus = function(candidateName, currentStatus) {
            const action = currentStatus === 'active' ? 'kh√≥a' : 'm·ªü kh√≥a';
            const icon = currentStatus === 'active' ? 'üîí' : 'üîì';

            return new Promise((resolve) => {
                const modal = document.createElement('div');
                modal.className = 'modal fade';
                modal.innerHTML = `
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content glass-effect">
                            <div class="modal-header border-0">
                                <h5 class="modal-title">${icon} X√°c nh·∫≠n thao t√°c</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body text-center">
                                <div class="mb-3">
                                    <i class="fas fa-question-circle fa-3x text-warning"></i>
                                </div>
                                <p class="lead">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën <strong>${action}</strong> t√†i kho·∫£n c·ªßa:</p>
                                <p class="h5 text-primary">${candidateName}</p>
                            </div>
                            <div class="modal-footer border-0 justify-content-center">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                    <i class="fas fa-times me-1"></i>H·ªßy
                                </button>
                                <button type="button" class="btn btn-primary" id="confirmBtn">
                                    <i class="fas fa-check me-1"></i>X√°c nh·∫≠n
                                </button>
                            </div>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);
                const bsModal = new bootstrap.Modal(modal);
                bsModal.show();

                document.getElementById('confirmBtn').addEventListener('click', () => {
                    resolve(true);
                    bsModal.hide();
                });

                modal.addEventListener('hidden.bs.modal', () => {
                    document.body.removeChild(modal);
                });
            });
        };

        // Smooth scrolling for pagination
        const paginationLinks = document.querySelectorAll('.pagination .page-link');
        paginationLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                loadingOverlay.classList.remove('d-none');

                setTimeout(() => {
                    window.location.href = this.href;
                }, 300);
            });
        });

        // Enhanced alert auto-dismiss
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(alert => {
            setTimeout(() => {
                const bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            }, 5000);
        });

        // Floating action button animation
        const fab = document.querySelector('.position-fixed.bottom-0 .btn');
        if (fab) {
            fab.addEventListener('mouseenter', function() {
                this.style.transform = 'scale(1.1) rotate(90deg)';
            });

            fab.addEventListener('mouseleave', function() {
                this.style.transform = 'scale(1) rotate(0deg)';
            });
        }
    });

    // Add CSS for ripple animation
    const style = document.createElement('style');
    style.textContent = `
        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
    `;
    document.head.appendChild(style);
</script>
</body>
</html>